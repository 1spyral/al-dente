# Apache Virtual Host configuration for Al Dente Frontend
# Place this in /etc/apache2/sites-available/

<VirtualHost *:80>
    ServerName yourdomain.com
    ServerAlias www.yourdomain.com
    
    # Redirect all HTTP to HTTPS
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
</VirtualHost>

<VirtualHost *:443>
    ServerName yourdomain.com
    ServerAlias www.yourdomain.com
    
    # Document root - point to your dist folder
    DocumentRoot /path/to/your/al-dente/frontend/dist
    
    # SSL Configuration (if not using Cloudflare SSL)
    SSLEngine on
    SSLCertificateFile /path/to/your/ssl/cert.pem
    SSLCertificateKeyFile /path/to/your/ssl/private.key
    
    # Security headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "no-referrer-when-downgrade"
    
    # Enable compression
    LoadModule deflate_module modules/mod_deflate.so
    <Location />
        SetOutputFilter DEFLATE
        SetEnvIfNoCase Request_URI \
            \.(?:gif|jpe?g|png)$ no-gzip dont-vary
        SetEnvIfNoCase Request_URI \
            \.(?:exe|t?gz|zip|bz2|sit|rar)$ no-gzip dont-vary
    </Location>
    
    # Asset caching
    <LocationMatch "\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$">
        ExpiresActive On
        ExpiresDefault "access plus 1 year"
        Header set Cache-Control "public, no-transform"
    </LocationMatch>
    
    # API proxy (optional - if you want frontend and backend on same domain)
    ProxyPreserveHost On
    ProxyRequests Off
    ProxyPass /api/ http://localhost:3000/
    ProxyPassReverse /api/ http://localhost:3000/
    
    # SPA fallback - CRITICAL for React Router
    <Directory "/path/to/your/al-dente/frontend/dist">
        RewriteEngine On
        
        # Handle Angular and React Routes
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
        
        # Prevent caching of index.html
        <Files "index.html">
            Header set Cache-Control "no-cache, no-store, must-revalidate"
            Header set Pragma "no-cache"
            Header set Expires "0"
        </Files>
    </Directory>
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/aldente_error.log
    CustomLog ${APACHE_LOG_DIR}/aldente_access.log combined
</VirtualHost>
